<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Portfolio</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* CORE LAYOUT */
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; display: flex; height: 100vh; overflow: hidden; }
        #sidebar { width: 260px; background-color: #0f172a; color: white; display: flex; flex-direction: column; padding: 24px; flex-shrink: 0; z-index: 20; }
        #main-content { flex-grow: 1; overflow-y: auto; padding: 32px; background-color: #f1f5f9; position: relative; }

        /* UI ELEMENTS */
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 10px; font-weight: 600; color: #94a3b8; cursor: pointer; transition: all 0.2s ease; margin-bottom: 4px; }
        .nav-item:hover { background-color: #1e293b; color: white; transform: translateX(4px); }
        .nav-item.active { background-color: #4f46e5; color: white; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); transform: translateX(0); }
        .card { background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; transition: transform 0.2s ease; }
        .input-std { width: 100%; padding: 10px 14px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; outline: none; transition: 0.2s; background-color: #fff; }
        .input-std:focus { border-color: #4f46e5; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }
        .chart-container { position: relative; height: 260px; width: 100%; }
        .chart-container-sm { position: relative; height: 180px; width: 100%; }
        .hidden { display: none !important; }
        .progress-bar-bg { background-color: #f1f5f9; border-radius: 999px; height: 6px; width: 100%; overflow: hidden; margin-top: 6px; }
        .progress-bar-fill { height: 100%; border-radius: 999px; transition: width 1s ease-in-out; }
        
        /* CALENDAR */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e2e8f0; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden; }
        .calendar-header { background-color: #f8fafc; padding: 12px 0; text-align: center; font-size: 11px; font-weight: 700; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; }
        .calendar-day { background-color: white; min-height: 100px; padding: 8px; position: relative; transition: background-color 0.2s; }
        .calendar-day:hover { background-color: #f8fafc; }
        .day-number { font-size: 12px; font-weight: 600; color: #94a3b8; margin-bottom: 4px; }
        .current-day { background-color: #f0f9ff; }
        .current-day .day-number { color: #0284c7; font-weight: 800; }
        
        /* BILL CHIPS */
        .bill-chip { display: flex; justify-content: space-between; align-items: center; font-size: 10px; padding: 4px 6px; border-radius: 4px; margin-bottom: 4px; cursor: pointer; transition: all 0.2s; border-left: 3px solid transparent; }
        .bill-chip.unpaid { background-color: #f1f5f9; color: #475569; border-left-color: #cbd5e1; }
        .bill-chip.unpaid:hover { background-color: #e2e8f0; }
        .bill-chip.paid { background-color: #dcfce7; color: #166534; border-left-color: #22c55e; text-decoration: line-through; opacity: 0.8; }
        .bill-chip.paid:hover { opacity: 1; }
        .bill-chip.overdue { border: 1px solid #fca5a5; background-color: #fef2f2; border-left: 3px solid #ef4444; }
        .btn-delete-bill { opacity: 0; transition: opacity 0.2s; padding: 2px; margin-left: 4px; color: #94a3b8; }
        .bill-chip:hover .btn-delete-bill { opacity: 1; }

        /* STATUS */
        .status-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; }
        .status-dot.active { background-color: #10b981; box-shadow: 0 0 8px #10b981; }
        .status-dot.inactive { background-color: #94a3b8; }
        .status-dot.syncing { background-color: #f59e0b; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    </style>
</head>
<body>

    <div id="sidebar">
        <div>
            <div class="flex items-center gap-3 mb-10">
                <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center shadow-lg transform rotate-3"><i class="fas fa-wallet text-white"></i></div>
                <h1 class="font-bold text-lg leading-tight">Finance<br>Portfolio</h1>
            </div>
            <div class="mb-8">
                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2 block">Timeline</label>
                <input type="month" id="monthPicker" class="w-full p-2.5 bg-slate-800 border border-slate-700 rounded-lg font-bold text-white text-sm outline-none focus:border-indigo-500 transition">
            </div>
            <nav>
                <div onclick="switchView('dashboard')" id="nav-dashboard" class="nav-item active"><i class="fas fa-chart-pie w-5"></i> Dashboard</div>
                <div onclick="switchView('bills')" id="nav-bills" class="nav-item"><i class="fas fa-calendar-alt w-5"></i> Bills</div>
                <div onclick="switchView('wealth')" id="nav-wealth" class="nav-item"><i class="fas fa-landmark w-5"></i> Net Worth</div>
                <div onclick="switchView('reports')" id="nav-reports" class="nav-item"><i class="fas fa-chart-line w-5"></i> Reports</div>
                <div onclick="switchView('settings')" id="nav-settings" class="nav-item"><i class="fas fa-sliders-h w-5"></i> Settings</div>
            </nav>
        </div>
        <div class="mt-auto pt-6 border-t border-slate-800">
            <div class="flex justify-between items-center mb-2 px-1">
                <span class="text-[10px] font-bold text-slate-500 uppercase tracking-wide">Auto-Sync</span>
                <span id="syncIndicator" class="text-[10px] text-slate-500 font-bold hidden"><i class="fas fa-check"></i></span>
            </div>
            <button onclick="manualSync(true)" id="btnSync" class="w-full py-2.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-bold text-xs transition mb-2 shadow-lg shadow-indigo-900/50">
                <i class="fas fa-cloud-upload-alt mr-2"></i> Sync Now
            </button>
            <div id="syncStatusWrapper" class="text-[10px] text-center text-slate-500 font-medium mt-1">
                <span id="statusDot" class="status-dot inactive"></span>
                <span id="statusText">Local Mode</span>
            </div>
        </div>
    </div>

    <div id="main-content">
        
        <div id="view-dashboard" class="view-section fade-in">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                <div class="card bg-slate-900 text-white col-span-1 md:col-span-2 lg:col-span-2 relative overflow-hidden group cursor-pointer border-none" onclick="editAnnualIncome()">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition transform group-hover:scale-110"><i class="fas fa-edit text-6xl"></i></div>
                    <p class="text-xs text-slate-400 font-bold uppercase mb-1">Annual Income Target</p>
                    <h2 class="text-3xl font-extrabold" id="kpiSalary">£0.00</h2>
                    <div class="mt-4 flex gap-4 text-xs font-medium text-slate-400">
                        <span><i class="fas fa-calendar-check text-emerald-400"></i> YTD: <span id="kpiYTD" class="text-white">£0</span></span>
                        <span><i class="fas fa-clock text-indigo-400"></i> Avg: <span id="kpiAvg" class="text-white">£0</span></span>
                    </div>
                </div>
                <div class="card border-l-4 border-emerald-500"><p class="text-xs text-slate-400 font-bold uppercase">Income (Month)</p><h3 class="text-2xl font-bold text-emerald-600 mt-1" id="kpiInc">£0.00</h3></div>
                <div class="card border-l-4 border-rose-500"><p class="text-xs text-slate-400 font-bold uppercase">Expenses (Month)</p><h3 class="text-2xl font-bold text-rose-600 mt-1" id="kpiExp">£0.00</h3></div>
                <div class="card border-l-4 border-violet-500 md:col-span-2 lg:col-span-1"><div class="overflow-hidden"><p class="text-xs text-slate-400 font-bold uppercase">Top Spending</p><h3 class="text-xl font-bold text-violet-600 mt-1 truncate" id="kpiMaxCat">N/A</h3><p class="text-xs text-slate-500 font-medium mt-1" id="kpiMaxVal">£0.00</p></div></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div class="card lg:col-span-2"><div class="flex justify-between items-center mb-6"><h3 class="font-bold text-slate-800">Cash Flow</h3><span class="text-[10px] font-bold bg-slate-100 text-slate-500 px-2 py-1 rounded">Last 6 Months</span></div><div class="chart-container"><canvas id="chartTrend"></canvas></div></div>
                <div class="card"><h3 class="font-bold text-slate-800 mb-6">Spending Breakdown</h3><div class="chart-container"><canvas id="chartSpend"></canvas></div></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="card h-fit sticky top-6">
                    <h3 class="font-bold text-lg mb-4 text-slate-800">Add Transaction</h3>
                    <form id="formTx" class="space-y-4">
                        <div class="grid grid-cols-2 gap-2 p-1 bg-slate-100 rounded-lg">
                            <button type="button" onclick="setTxType('expense')" id="btnExp" class="py-2 rounded-md text-sm font-bold bg-white text-rose-600 shadow-sm transition">Expense</button>
                            <button type="button" onclick="setTxType('income')" id="btnInc" class="py-2 rounded-md text-sm font-bold text-slate-400 transition">Income</button>
                        </div>
                        <div><label class="text-[10px] font-bold text-slate-400 uppercase">Description</label><input type="text" id="txDesc" placeholder="e.g. Grocery Shop" class="input-std mt-1" required></div>
                        <div class="flex gap-3">
                            <div class="w-1/2"><label class="text-[10px] font-bold text-slate-400 uppercase">Amount</label><input type="number" id="txAmt" placeholder="0.00" step="0.01" class="input-std mt-1" required></div>
                            <div class="w-1/2"><label class="text-[10px] font-bold text-slate-400 uppercase">Category</label><select id="txCat" class="input-std mt-1 bg-white cursor-pointer" onchange="checkNewCategory(this)"></select></div>
                        </div>
                        <button type="submit" class="w-full py-3 bg-slate-900 hover:bg-slate-800 text-white rounded-lg font-bold text-sm shadow-md transition mt-2"><i class="fas fa-plus mr-1"></i> Add Transaction</button>
                    </form>
                </div>
                <div class="card lg:col-span-2 min-h-[400px]">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg text-slate-800">Recent Transactions</h3><span class="text-xs font-bold text-slate-400 bg-slate-100 px-2 py-1 rounded">This Month</span></div>
                    <div class="overflow-x-auto"><table class="w-full text-left border-collapse"><thead><tr class="text-xs text-slate-400 uppercase border-b border-slate-100"><th class="py-2 font-bold pl-2">Description</th><th class="py-2 font-bold text-right">Amount</th><th class="py-2 font-bold text-right pr-2">Action</th></tr></thead><tbody id="listTx" class="text-sm"></tbody></table><div id="emptyState" class="hidden py-12 text-center"><div class="inline-block p-4 rounded-full bg-slate-50 mb-3"><i class="fas fa-receipt text-slate-300 text-2xl"></i></div><p class="text-slate-400 font-medium text-sm">No transactions yet.</p></div></div>
                </div>
            </div>
        </div>

        <div id="view-bills" class="view-section hidden fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-2"><div><h2 class="text-2xl font-extrabold text-slate-800 tracking-tight">Bill Calendar</h2><p class="text-sm text-slate-500">Real-time liquidity and fixed cost planning.</p></div></div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="card border-l-4 border-slate-500"><p class="text-xs text-slate-400 font-bold uppercase">Monthly Bills</p><h3 class="text-2xl font-bold text-slate-700 mt-1" id="billTotal">£0.00</h3></div>
                <div class="card border-l-4 border-sky-500"><p class="text-xs text-slate-400 font-bold uppercase">Yearly Cost</p><h3 class="text-2xl font-bold text-sky-600 mt-1" id="billYearly">£0.00</h3></div>
                <div class="card border-l-4 border-indigo-500"><p class="text-xs text-slate-400 font-bold uppercase">Bill-to-Income</p><h3 class="text-2xl font-bold text-indigo-600 mt-1" id="billRatio">0%</h3></div>
                <div class="card border-l-4 border-emerald-500 bg-emerald-50 border-none"><p class="text-xs text-emerald-600 font-bold uppercase">Real-Time Safe</p><h3 class="text-2xl font-bold text-emerald-700 mt-1" id="billSafe">£0.00</h3><p class="text-[10px] text-emerald-600 mt-1">Income - Exp - Unpaid</p></div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="card h-fit"><h3 class="font-bold text-lg mb-4 text-slate-800">Add Recurring Bill</h3><p class="text-xs text-slate-400 mb-4">Bills repeat automatically every month.</p><form id="formBill" class="space-y-4"><div><label class="text-[10px] font-bold text-slate-400 uppercase">Bill Name</label><input type="text" id="billName" placeholder="e.g. Rent" class="input-std mt-1" required></div><div class="flex gap-3"><div class="w-1/2"><label class="text-[10px] font-bold text-slate-400 uppercase">Amount</label><input type="number" id="billAmt" placeholder="0.00" step="0.01" class="input-std mt-1" required></div><div class="w-1/2"><label class="text-[10px] font-bold text-slate-400 uppercase">Due Day</label><input type="number" id="billDay" placeholder="1-31" min="1" max="31" class="input-std mt-1" required></div></div><button type="submit" class="w-full py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-lg font-bold text-sm shadow-md transition mt-2"><i class="fas fa-plus-circle mr-1"></i> Add Bill</button></form><div class="mt-8 pt-6 border-t border-slate-100"><div class="flex justify-between items-end mb-2"><span class="text-xs font-bold text-slate-400 uppercase">Paid Status</span><span class="text-sm font-bold text-indigo-600" id="billProgressText">0%</span></div><div class="progress-bar-bg"><div class="progress-bar-fill bg-indigo-500" id="billProgressBar" style="width: 0%"></div></div></div></div>
                <div class="card lg:col-span-2 min-h-[500px] p-0 overflow-hidden"><div class="p-4 bg-white border-b border-slate-100 flex justify-between items-center"><h3 class="font-bold text-lg text-slate-800"><span id="calendarMonthLabel"></span></h3><div class="flex items-center gap-2 text-[10px] font-bold uppercase"><span class="flex items-center gap-1 text-emerald-600"><div class="w-3 h-3 bg-emerald-200"></div> Paid</span><span class="flex items-center gap-1 text-slate-500 ml-2"><div class="w-3 h-3 bg-slate-200"></div> Unpaid</span></div></div><div class="calendar-grid"><div class="calendar-header">Mon</div><div class="calendar-header">Tue</div><div class="calendar-header">Wed</div><div class="calendar-header">Thu</div><div class="calendar-header">Fri</div><div class="calendar-header text-rose-400">Sat</div><div class="calendar-header text-rose-400">Sun</div><div id="calendarCells" class="contents"></div></div></div>
            </div>
        </div>

        <div id="view-wealth" class="view-section hidden fade-in">
            <h2 class="text-2xl font-extrabold text-slate-800 tracking-tight mb-8">Net Worth & Retirement</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="card bg-slate-900 text-white flex flex-col justify-center relative overflow-hidden shadow-lg shadow-slate-900/20"><div class="relative z-10"><p class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-1">Total Net Worth</p><h2 class="text-4xl font-extrabold" id="wealthNet">£0.00</h2><div class="mt-4 flex gap-4 text-xs font-medium text-slate-400"><span class="text-emerald-400"><i class="fas fa-arrow-up"></i> Assets: <span id="wealthAssetsTotal" class="text-white">£0</span></span><span class="text-rose-400"><i class="fas fa-arrow-down"></i> Debt: <span id="wealthDebtTotal" class="text-white">£0</span></span></div></div><i class="fas fa-university absolute -bottom-6 -right-6 text-[100px] text-white opacity-5"></i></div>
                <div class="card flex flex-col justify-center items-center"><h3 class="font-bold text-slate-800 mb-2 text-sm uppercase tracking-wide">Composition</h3><div class="chart-container-sm"><canvas id="chartWealth"></canvas></div></div>
                <div class="card border border-slate-200"><div class="flex justify-between items-end mb-4"><div><h3 class="font-bold text-slate-800 text-lg">Retirement</h3><p class="text-xs text-slate-500 mt-1">4% Rule (25x Exp)</p></div><div class="text-right"><p class="text-xs text-slate-400 font-bold uppercase">Freedom</p><h3 class="text-xl font-bold text-indigo-600" id="wealthFireNumber">£0.00</h3></div></div><div class="relative pt-2"><div class="flex justify-between text-xs font-bold mb-2"><span class="text-slate-500">0%</span><span class="text-indigo-600" id="wealthFirePct">0%</span><span class="text-slate-500">100%</span></div><div class="w-full bg-slate-100 rounded-full h-4 overflow-hidden"><div class="bg-gradient-to-r from-indigo-500 to-purple-500 h-4 rounded-full transition-all duration-1000 ease-out" id="wealthFireBar" style="width: 0%"></div></div><p class="text-xs text-center text-slate-400 mt-3" id="wealthFireMsg">Loading...</p></div></div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card h-fit"><h3 class="font-bold text-lg text-emerald-700 mb-4">Assets</h3><form id="formAsset" class="mb-6 p-3 bg-emerald-50 rounded-lg border border-emerald-100"><div class="mb-2"><label class="text-[10px] font-bold text-emerald-600 uppercase">Type</label><select id="assetType" class="input-std mt-1 bg-white border-emerald-200"><option value="Savings">Savings</option><option value="Investment">Investment</option><option value="Property">Property</option><option value="Vehicle">Vehicle</option><option value="Cash">Cash</option><option value="Other">Other</option></select></div><div class="flex gap-2 mb-2"><div class="w-2/3"><label class="text-[10px] font-bold text-emerald-600 uppercase">Name</label><input type="text" id="assetName" placeholder="e.g. ISA" class="input-std mt-1 border-emerald-200" required></div><div class="w-1/3"><label class="text-[10px] font-bold text-emerald-600 uppercase">Value</label><input type="number" id="assetVal" placeholder="0.00" class="input-std mt-1 border-emerald-200" required></div></div><button class="w-full bg-emerald-600 hover:bg-emerald-700 text-white rounded-md py-2 font-bold text-xs shadow-sm transition">Add Asset</button></form><div id="listAssets" class="space-y-2"></div></div>
                <div class="card h-fit"><h3 class="font-bold text-lg text-rose-700 mb-4">Liabilities (Debt)</h3><form id="formDebt" class="mb-6 p-3 bg-rose-50 rounded-lg border border-rose-100"><div class="mb-2"><label class="text-[10px] font-bold text-rose-600 uppercase">Type</label><select id="debtType" class="input-std mt-1 bg-white border-rose-200"><option value="Mortgage">Mortgage</option><option value="Loan">Personal Loan</option><option value="Credit Card">Credit Card</option><option value="Student Loan">Student Loan</option><option value="Other">Other</option></select></div><div class="flex gap-2 mb-2"><div class="w-2/3"><label class="text-[10px] font-bold text-rose-600 uppercase">Name</label><input type="text" id="debtName" placeholder="e.g. Amex" class="input-std mt-1 border-rose-200" required></div><div class="w-1/3"><label class="text-[10px] font-bold text-rose-600 uppercase">Amount</label><input type="number" id="debtVal" placeholder="0.00" class="input-std mt-1 border-rose-200" required></div></div><button class="w-full bg-rose-600 hover:bg-rose-700 text-white rounded-md py-2 font-bold text-xs shadow-sm transition">Add Debt</button></form><div id="listDebts" class="space-y-2"></div></div>
            </div>
        </div>

        <div id="view-reports" class="view-section hidden fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4"><div><h2 class="text-2xl font-extrabold text-slate-800 tracking-tight">Yearly Analytics</h2><p class="text-sm text-slate-500">Strategic overview of your finances.</p></div><div class="flex gap-2 bg-white p-1 rounded-lg shadow-sm border border-slate-200"><select id="reportYearSelect" class="bg-transparent font-bold text-sm text-slate-700 px-3 py-1 outline-none cursor-pointer" onchange="renderReports()"></select><button onclick="downloadCSV()" class="bg-slate-800 hover:bg-slate-700 text-white text-xs font-bold px-3 py-1 rounded-md transition flex items-center"><i class="fas fa-file-csv mr-2"></i> Export Data</button></div></div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="card border-t-4 border-emerald-500 shadow-sm"><div class="flex justify-between items-start"><div><p class="text-xs font-bold text-slate-400 uppercase tracking-wide">Total Income</p><h3 class="text-2xl font-bold text-emerald-600 mt-1" id="rptInc">£0.00</h3></div><div class="p-2 bg-emerald-50 rounded-lg text-emerald-500"><i class="fas fa-wallet"></i></div></div></div>
                <div class="card border-t-4 border-rose-500 shadow-sm"><div class="flex justify-between items-start"><div><p class="text-xs font-bold text-slate-400 uppercase tracking-wide">Total Expenses</p><h3 class="text-2xl font-bold text-rose-600 mt-1" id="rptExp">£0.00</h3></div><div class="p-2 bg-rose-50 rounded-lg text-rose-500"><i class="fas fa-receipt"></i></div></div></div>
                <div class="card border-t-4 border-indigo-500 shadow-sm"><div class="flex justify-between items-start"><div><p class="text-xs font-bold text-slate-400 uppercase tracking-wide">Net Savings</p><h3 class="text-2xl font-bold text-indigo-600 mt-1" id="rptSav">£0.00</h3></div><div class="p-2 bg-indigo-50 rounded-lg text-indigo-500"><i class="fas fa-piggy-bank"></i></div></div></div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div class="card lg:col-span-2"><h3 class="font-bold text-lg text-slate-800 mb-4">Income vs
