function toggleBill(id) { 
            const key = monthPicker.value; 
            if(!db.billStatus[key]) db.billStatus[key] = {}; 
            
            // 1. Find the bill details safely using the ID
            const bill = db.bills.find(b => b.id === id);
            if (!bill) { console.error("Bill not found!"); return; }

            const s = db.billStatus[key][id];
            const isCurrentlyPaid = (typeof s === 'object') ? s.paid : !!s;
            const newState = { paid: !isCurrentlyPaid, updated: Date.now() };

            if(!isCurrentlyPaid) { 
                // Use the safe 'bill.name' and 'bill.amount' we found above
                if(confirm(`Mark '${bill.name}' as paid?\n\nThis will automatically add a Â£${bill.amount} transaction to your main dashboard.`)) { 
                    db.billStatus[key][id] = newState; 
                    if(!db.transactions[key]) db.transactions[key] = []; 
                    db.transactions[key].push({ 
                        id: genId(), 
                        updatedAt: Date.now(), 
                        desc: bill.name, 
                        amount: math(bill.amount), 
                        category: 'Bills', 
                        type: 'expense' 
                    }); 
                    save(); 
                } 
            } else { 
                db.billStatus[key][id] = newState; 
                save(); 
            } 
        }

